{% extends 'base.html.twig' %}

{% block title %}Boutique{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="css/panier.css">
{% endblock %}

{% block body %}
<div class="container mt-4">
    <h3>Panier : <span id="cart-count">0</span> article(s)</h3>
    <div class="row">
        {% for product in products %}
            <div class="col-md-3">
                <div class="product-card">
                    <img class="product-img" src="https://cdn.shopify.com/s/files/1/2358/2817/products/dunk-low-next-nature-black-white-330678.png?v=1638813895" alt="{{ product.name }}">
                    <div class="product-info mt-3">
                        <h5>{{ product.name }}</h5>
                        <p class="text-muted">{{ product.price }} â‚¬</p>
                        <button 
                            class="add-to-cart-btn"
                            data-id="{{ product.id }}"
                            data-name="{{ product.name }}"
                            data-price="{{ product.price }}"
                        >Ajouter au panier</button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    function updateCartCount() {
        document.getElementById('cart-count').textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
    }

    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
    }

    function addToCart(product) {
        const existing = cart.find(p => p.id === product.id);
        if (existing) {
            existing.quantity += 1;
        } else {
            product.quantity = 1;
            cart.push(product);
        }
        saveCart();
    }

    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', () => {
            const product = {
                id: button.dataset.id,
                name: button.dataset.name,
                price: parseFloat(button.dataset.price)
            };
            addToCart(product);
        });
    });

    updateCartCount();
</script>
{% endblock %}
